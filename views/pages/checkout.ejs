<%- include('../partials/header') %>

<div class="checkout-container">
    <h1>Checkout</h1>
    
    <div class="order-summary">
        <h2>Order Summary</h2>
        <% let total = 0 %>
        <% cart.forEach(item => { %>
            <div class="cart-item">
                <img src="<%= item.image %>" alt="<%= item.name %>">
                <div class="item-details">
                    <h3><%= item.name %></h3>
                    <p>Size: <%= item.size %></p>
                    <p>Color: <%= item.color %></p>
                    <p>Quantity: <%= item.quantity %></p>
                    <p>Price: $<%= item.price * item.quantity %></p>
                </div>
            </div>
            <% total += item.price * item.quantity %>
        <% }) %>
        <div class="total">
            <h3>Total: $<%= total %></h3>
        </div>
    </div>

    <form id="checkout-form" class="shipping-form">
        <h2>Shipping Details</h2>
        <div class="form-group">
            <label for="address">Street Address</label>
            <input type="text" id="address" name="address" required>
        </div>
        <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" name="city" required>
        </div>
        <div class="form-group">
            <label for="state">State</label>
            <input type="text" id="state" name="state" required>
        </div>
        <div class="form-group">
            <label for="postalCode">Postal Code</label>
            <input type="text" id="postalCode" name="postalCode" required>
        </div>
        <div class="form-group">
            <label for="country">Country</label>
            <input type="text" id="country" name="country" required>
        </div>
        <button type="submit" class="checkout-btn">Place Order</button>
    </form>
</div>

<script>
document.getElementById('checkout-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        state: document.getElementById('state').value,
        postalCode: document.getElementById('postalCode').value,
        country: document.getElementById('country').value
    };

    try {
        const response = await fetch('/cart/checkout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
            alert('Order placed successfully!');
            window.location.href = '/orders/' + data.orderId;
        } else {
            alert(data.error || 'Failed to place order');
        }
    } catch (error) {
        console.error('Checkout error:', error);
        alert('Failed to process checkout');
    }
});
</script>

<%- include('../partials/footer') %>